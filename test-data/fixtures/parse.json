[
  {"name": "empty input", "input": "", "expected": {}},
  {"name": "bare name (flag)", "input": "just_name", "expected": {"properties": {"just_name": {}}}},
  {"name": "name = bare string", "input": "name = bare_string", "expected": {"properties": {"name": {"eq": "bare_string"}}}},
  {"name": "name = quoted string", "input": "name = \"quoted_string\"", "expected": {"properties": {"name": {"eq": "quoted_string"}}}},
  {"name": "name = single quoted string", "input": "name = 'single quoted'", "expected": {"properties": {"name": {"eq": "single quoted"}}}},
  {"name": "triple quoted string", "input": "desc = \"\"\"hello\"\"\"", "expected": {"properties": {"desc": {"eq": "hello"}}}},
  {"name": "triple quoted multiline", "input": "desc = \"\"\"line one\nline two\"\"\"", "expected": {"properties": {"desc": {"eq": "line one\nline two"}}}},
  {"name": "triple quoted with quotes", "input": "desc = \"\"\"has \\\" quote\"\"\"", "expected": {"properties": {"desc": {"eq": "has \" quote"}}}},
  {"name": "multiple properties", "input": "name = hello  port = 8080", "expected": {"properties": {"name": {"eq": "hello"}, "port": {"eq": 8080}}}},
  {"name": "nested properties", "input": "outer { inner = hello }", "expected": {"properties": {"outer": {"properties": {"inner": {"eq": "hello"}}}}}},
  {"name": "name with property", "input": "name {prop1}", "expected": {"properties": {"name": {"properties": {"prop1": {}}}}}},
  {"name": "name with multiple properties", "input": "name {prop1 prop2=value}", "expected": {"properties": {"name": {"properties": {"prop1": {}, "prop2": {"eq": "value"}}}}}},
  {"name": "dotted name", "input": "name.prop", "expected": {"properties": {"name": {"properties": {"prop": {}}}}}},
  {"name": "dotted name with value", "input": "name.prop = value", "expected": {"properties": {"name": {"properties": {"prop": {"eq": "value"}}}}}},
  {"name": "dotted name deep", "input": "name.prop.sub = value", "expected": {"properties": {"name": {"properties": {"prop": {"properties": {"sub": {"eq": "value"}}}}}}}},
  {"name": "integer value", "input": "x = 7", "expected": {"properties": {"x": {"eq": 7}}}},
  {"name": "negative integer", "input": "x = -7", "expected": {"properties": {"x": {"eq": -7}}}},
  {"name": "float value", "input": "x = 7.0", "expected": {"properties": {"x": {"eq": 7}}}},
  {"name": "decimal only", "input": "x = .01", "expected": {"properties": {"x": {"eq": 0.01}}}},
  {"name": "point seven", "input": "x = .7", "expected": {"properties": {"x": {"eq": 0.7}}}},
  {"name": "scientific lower", "input": "x = .7e2", "expected": {"properties": {"x": {"eq": 70}}}},
  {"name": "scientific upper", "input": "x = 7E2", "expected": {"properties": {"x": {"eq": 700}}}},
  {"name": "boolean true", "input": "enabled = @true", "expected": {"properties": {"enabled": {"eq": true}}}},
  {"name": "boolean false", "input": "disabled = @false", "expected": {"properties": {"disabled": {"eq": false}}}},
  {"name": "date only", "input": "created = @2024-01-15", "expected": {"properties": {"created": {"eq": {"$date": "2024-01-15"}}}}},
  {"name": "date with time", "input": "updated = @2024-01-15T10:30:00Z", "expected": {"properties": {"updated": {"eq": {"$date": "2024-01-15T10:30:00Z"}}}}},
  {"name": "array of strings", "input": "items = [a, b, c]", "expected": {"properties": {"items": {"eq": [{"eq": "a"}, {"eq": "b"}, {"eq": "c"}]}}}},
  {"name": "empty array", "input": "a = []", "expected": {"properties": {"a": {"eq": []}}}},
  {"name": "array trailing comma", "input": "x = [a,]", "expected": {"properties": {"x": {"eq": [{"eq": "a"}]}}}},
  {"name": "array of booleans", "input": "flags = [@true, @false]", "expected": {"properties": {"flags": {"eq": [{"eq": true}, {"eq": false}]}}}},
  {"name": "array element with properties", "input": "x = [a {A}]", "expected": {"properties": {"x": {"eq": [{"eq": "a", "properties": {"A": {}}}]}}}},
  {"name": "array element just properties", "input": "x = [{A}]", "expected": {"properties": {"x": {"eq": [{"properties": {"A": {}}}]}}}},
  {"name": "reference", "input": "ref = $^sibling", "expected": {"properties": {"ref": {"eq": {"linkTo": "$^sibling"}}}}},
  {"name": "reference absolute", "input": "ref = $root.name", "expected": {"properties": {"ref": {"eq": {"linkTo": "$root.name"}}}}},
  {"name": "deleted node", "input": "-gone", "expected": {"properties": {"gone": {"deleted": true}}}},
  {"name": "delete existing", "input": "no yes -no", "expected": {"properties": {"no": {"deleted": true}, "yes": {}}}},
  {"name": "delete nested", "input": "x -x.y", "expected": {"properties": {"x": {"properties": {"y": {"deleted": true}}}}}},
  {"name": "clear all", "input": "can remove.properties -...", "expected": {"properties": {}}},
  {"name": "value with merge properties", "input": "name = value {prop}", "expected": {"properties": {"name": {"eq": "value", "properties": {"prop": {}}}}}},
  {"name": "space merge preserves value", "input": "x = 1 x {xx = 11}", "expected": {"properties": {"x": {"eq": 1, "properties": {"xx": {"eq": 11}}}}}},
  {"name": "eq preserves existing properties", "input": "a {b c} a = 1", "expected": {"properties": {"a": {"eq": 1, "properties": {"b": {}, "c": {}}}}}},
  {"name": "eq preserves properties across statements", "input": "x.y = xx x = 1", "expected": {"properties": {"x": {"eq": 1, "properties": {"y": {"eq": "xx"}}}}}},
  {"name": "colon preserves existing value", "input": "a = 1 a: {b}", "expected": {"properties": {"a": {"eq": 1, "properties": {"b": {}}}}}},
  {"name": "colon replaces properties", "input": "name: { prop }", "expected": {"properties": {"name": {"properties": {"prop": {}}}}}},
  {"name": "colon replaces old props", "input": "name { old } name: { new }", "expected": {"properties": {"name": {"properties": {"new": {}}}}}},
  {"name": "space merges props", "input": "name { old } name { new }", "expected": {"properties": {"name": {"properties": {"new": {}, "old": {}}}}}},
  {"name": "colon preserves value replaces props", "input": "name = val name: { prop }", "expected": {"properties": {"name": {"eq": "val", "properties": {"prop": {}}}}}},
  {"name": "space preserves existing value", "input": "name = val name { prop }", "expected": {"properties": {"name": {"eq": "val", "properties": {"prop": {}}}}}},
  {"name": "accumulate two parses", "input": ["name = hello", "port = 8080"], "expected": {"properties": {"name": {"eq": "hello"}, "port": {"eq": 8080}}}},
  {"name": "backtick identifier", "input": "`spacey name` = Zaphod", "expected": {"properties": {"spacey name": {"eq": "Zaphod"}}}},
  {"name": "escape newline", "input": "x = \"hello\\nworld\"", "expected": {"properties": {"x": {"eq": "hello\nworld"}}}},
  {"name": "escape tab", "input": "x = \"hello\\tworld\"", "expected": {"properties": {"x": {"eq": "hello\tworld"}}}},
  {"name": "escape backslash", "input": "x = \"hello\\\\world\"", "expected": {"properties": {"x": {"eq": "hello\\world"}}}},
  {"name": "escape unicode", "input": "x = \"hello\\u0026world\"", "expected": {"properties": {"x": {"eq": "hello&world"}}}},
  {"name": "raw single quote backslash pairing", "input": "x = 'hello\\'world'", "expected": {"properties": {"x": {"eq": "hello\\'world"}}}},
  {"name": "raw single quote literal backslash", "input": "x = 'hello\\nworld'", "expected": {"properties": {"x": {"eq": "hello\\nworld"}}}},
  {"name": "comment ignored", "input": "x = 1 # this is a comment", "expected": {"properties": {"x": {"eq": 1}}}},
  {"name": "comment on own line", "input": "# comment\nx = 1", "expected": {"properties": {"x": {"eq": 1}}}},
  {"name": "triple quoted with two quotes", "input": "desc = \"\"\"has \"\" two quotes\"\"\"", "expected": {"properties": {"desc": {"eq": "has \"\" two quotes"}}}},
  {"name": "triple single quoted basic", "input": "x = '''hello world'''", "expected": {"properties": {"x": {"eq": "hello world"}}}},
  {"name": "triple single quoted multiline", "input": "x = '''line one\nline two'''", "expected": {"properties": {"x": {"eq": "line one\nline two"}}}},
  {"name": "triple single quoted with quotes", "input": "x = '''it's a 'test' ok'''", "expected": {"properties": {"x": {"eq": "it's a 'test' ok"}}}},
  {"name": "triple single quoted raw backslash", "input": "x = '''\\d+\\.\\d+'''", "expected": {"properties": {"x": {"eq": "\\d+\\.\\d+"}}}},
  {"name": "escape carriage return", "input": "x = \"hello\\rworld\"", "expected": {"properties": {"x": {"eq": "hello\rworld"}}}},
  {"name": "escape backspace", "input": "x = \"hello\\bworld\"", "expected": {"properties": {"x": {"eq": "hello\bworld"}}}},
  {"name": "escape form feed", "input": "x = \"hello\\fworld\"", "expected": {"properties": {"x": {"eq": "hello\fworld"}}}},
  {"name": "escape double quote", "input": "x = \"hello\\\"world\"", "expected": {"properties": {"x": {"eq": "hello\"world"}}}},
  {"name": "escape unicode uppercase", "input": "x = \"\\u003F\"", "expected": {"properties": {"x": {"eq": "?"}}}},
  {"name": "backtick escape", "input": "`hello\\`world` = value", "expected": {"properties": {"hello`world": {"eq": "value"}}}},
  {"name": "unicode bare string", "input": "café = open", "expected": {"properties": {"café": {"eq": "open"}}}},
  {"name": "multiline input", "input": "person {\n  name = \"ted\"\n  age = 42\n}", "expected": {"properties": {"person": {"properties": {"age": {"eq": 42}, "name": {"eq": "ted"}}}}}},
  {"name": "nested value with properties", "input": "image { alt = hello { field = department } }", "expected": {"properties": {"image": {"properties": {"alt": {"eq": "hello", "properties": {"field": {"eq": "department"}}}}}}}},
  {"name": "dotted path equivalence", "input": "image image.alt = hello image.alt.field = department", "expected": {"properties": {"image": {"properties": {"alt": {"eq": "hello", "properties": {"field": {"eq": "department"}}}}}}}},
  {"name": "deeply nested dotted path", "input": "a.b.c.d.e = f", "expected": {"properties": {"a": {"properties": {"b": {"properties": {"c": {"properties": {"d": {"properties": {"e": {"eq": "f"}}}}}}}}}}}},
  {"name": "nested arrays", "input": "x = [[a, b], [c, d]]", "expected": {"properties": {"x": {"eq": [{"eq": [{"eq": "a"}, {"eq": "b"}]}, {"eq": [{"eq": "c"}, {"eq": "d"}]}]}}}},
  {"name": "array of objects", "input": "items = [{name = alice age = 30}, {name = bob age = 25}]", "expected": {"properties": {"items": {"eq": [{"properties": {"age": {"eq": 30}, "name": {"eq": "alice"}}}, {"properties": {"age": {"eq": 25}, "name": {"eq": "bob"}}}]}}}},
  {"name": "reference dotted path", "input": "target = $config.db.host", "expected": {"properties": {"target": {"eq": {"linkTo": "$config.db.host"}}}}},
  {"name": "reference up two levels", "input": "a { ref = $^^root.path }", "expected": {"properties": {"a": {"properties": {"ref": {"eq": {"linkTo": "$^^root.path"}}}}}}},
  {"name": "reference array index", "input": "target = $items[1]", "expected": {"properties": {"target": {"eq": {"linkTo": "$items[1]"}}}}},
  {"name": "references in array", "input": "refs = [$source, $source]", "expected": {"properties": {"refs": {"eq": [{"eq": {"linkTo": "$source"}}, {"eq": {"linkTo": "$source"}}]}}}},
  {"name": "reference complex path", "input": "ref = $items[0].name", "expected": {"properties": {"ref": {"eq": {"linkTo": "$items[0].name"}}}}},
  {"name": "date with timezone offset", "input": "ts = @2024-01-15T10:30:00+05:00", "expected": {"properties": {"ts": {"eq": {"$date": "2024-01-15T10:30:00+05:00"}}}}},
  {"name": "scientific notation large", "input": "x = 1.5e10", "expected": {"properties": {"x": {"eq": 15000000000}}}},
  {"name": "scientific notation negative exponent", "input": "x = 3.14E-2", "expected": {"properties": {"x": {"eq": 0.0314}}}},
  {"name": "comment only", "input": "# just a comment", "expected": {}},
  {"name": "whitespace only", "input": "   ", "expected": {}},
  {"name": "mixed types in block", "input": "config { enabled = @true count = 42 name = test }", "expected": {"properties": {"config": {"properties": {"count": {"eq": 42}, "enabled": {"eq": true}, "name": {"eq": "test"}}}}}},
  {"name": "delete from properties", "input": "x {y} -x.y", "expected": {"properties": {"x": {"properties": {"y": {"deleted": true}}}}}},
  {"name": "delete one of properties", "input": "x {y z} -x.y", "expected": {"properties": {"x": {"properties": {"z": {}, "y": {"deleted": true}}}}}},
  {"name": "delete via block", "input": "x {y z} x {-y}", "expected": {"properties": {"x": {"properties": {"z": {}, "y": {"deleted": true}}}}}},
  {"name": "colon replace multiple", "input": "name: { a=1 b=2 }", "expected": {"properties": {"name": {"properties": {"a": {"eq": 1}, "b": {"eq": 2}}}}}},
  {"name": "colon with dotted paths", "input": "a.b: { c }", "expected": {"properties": {"a": {"properties": {"b": {"properties": {"c": {}}}}}}}},
  {"name": "space merge with dotted paths", "input": "a.b { c } a.b { d }", "expected": {"properties": {"a": {"properties": {"b": {"properties": {"c": {}, "d": {}}}}}}}},
  {"name": "colon replace with dotted paths", "input": "a.b { c } a.b: { d }", "expected": {"properties": {"a": {"properties": {"b": {"properties": {"d": {}}}}}}}},
  {"name": "raw single quote simple", "input": "x='hello world'", "expected": {"properties": {"x": {"eq": "hello world"}}}},
  {"name": "raw single ending double backslash", "input": "x='\\\\'", "expected": {"properties": {"x": {"eq": "\\\\"}}}},
  {"name": "raw single four backslashes", "input": "x='\\\\\\\\'", "expected": {"properties": {"x": {"eq": "\\\\\\\\"}}}},
  {"name": "triple single backslash before delimiter", "input": "x='''\\''''", "expected": {"properties": {"x": {"eq": "\\'"}}}},
  {"name": "triple single double backslash then close", "input": "x='''\\\\'''", "expected": {"properties": {"x": {"eq": "\\\\"}}}},
  {"name": "raw single quote regex", "input": "pattern='^\\d+\\.\\d+\\.\\d+$'", "expected": {"properties": {"pattern": {"eq": "^\\d+\\.\\d+\\.\\d+$"}}}},
  {"name": "comment after statement multiline", "input": "a=1 # comment\nb=2", "expected": {"properties": {"a": {"eq": 1}, "b": {"eq": 2}}}},

  {"name": "comma between top-level statements", "input": "a=1, b=2", "expected": {"properties": {"a": {"eq": 1}, "b": {"eq": 2}}}},
  {"name": "comma between properties in block", "input": "x{ a=1, b=2 }", "expected": {"properties": {"x": {"properties": {"a": {"eq": 1}, "b": {"eq": 2}}}}}},
  {"name": "trailing comma in block", "input": "x{ a=1, b=2, }", "expected": {"properties": {"x": {"properties": {"a": {"eq": 1}, "b": {"eq": 2}}}}}},
  {"name": "leading commas", "input": ",,,a=1", "expected": {"properties": {"a": {"eq": 1}}}},
  {"name": "multiple commas between statements", "input": "a=1,,,b=2", "expected": {"properties": {"a": {"eq": 1}, "b": {"eq": 2}}}},
  {"name": "commas with whitespace", "input": "a=1 , , b=2", "expected": {"properties": {"a": {"eq": 1}, "b": {"eq": 2}}}},
  {"name": "comma only input", "input": ",,,", "expected": {}},
  {"name": "commas in block with flags", "input": "x{ a, b, c }", "expected": {"properties": {"x": {"properties": {"a": {}, "b": {}, "c": {}}}}}},

  {"name": "assign both basic", "input": "a := 1", "expected": {"properties": {"a": {"eq": 1}}}},
  {"name": "assign both replaces everything", "input": "a {b c} a := 1", "expected": {"properties": {"a": {"eq": 1}}}},
  {"name": "assign both with properties", "input": "a := hello { x = 1 }", "expected": {"properties": {"a": {"eq": "hello", "properties": {"x": {"eq": 1}}}}}},
  {"name": "assign both replaces existing properties", "input": "a { old } a := hello { new }", "expected": {"properties": {"a": {"eq": "hello", "properties": {"new": {}}}}}},
  {"name": "none clears value", "input": "a = 1 a = @none", "expected": {"properties": {"a": {}}}},
  {"name": "none clears value preserves props", "input": "a = 1 a {x} a = @none", "expected": {"properties": {"a": {"properties": {"x": {}}}}}},
  {"name": "none with merge properties", "input": "a = 1 a = @none { b }", "expected": {"properties": {"a": {"properties": {"b": {}}}}}},
  {"name": "assign both none", "input": "a = 1 a {x} a := @none", "expected": {"properties": {"a": {}}}},
  {"name": "clone reference", "input": "source { a = 1 b = 2 } clone := $source", "expected": {"properties": {"source": {"properties": {"a": {"eq": 1}, "b": {"eq": 2}}}, "clone": {"properties": {"a": {"eq": 1}, "b": {"eq": 2}}}}}},
  {"name": "clone reference with property overrides", "input": "source { a = 1 b = 2 } clone := $source { c = 3 }", "expected": {"properties": {"source": {"properties": {"a": {"eq": 1}, "b": {"eq": 2}}}, "clone": {"properties": {"c": {"eq": 3}}}}}},
  {"name": "clone unresolved reference", "input": "x := $nonexistent", "expectErrors": true},
  {"name": "clone with legal relative ref", "input": "source { shared = hello  child { ref = $^shared } }  copy := $source", "expected": {"properties": {"source": {"properties": {"shared": {"eq": "hello"}, "child": {"properties": {"ref": {"eq": {"linkTo": "$^shared"}}}}}}, "copy": {"properties": {"shared": {"eq": "hello"}, "child": {"properties": {"ref": {"eq": {"linkTo": "$^shared"}}}}}}}}},
  {"name": "clone escaping relative ref", "input": "source { ref = $^^outside }  copy := $source", "expectErrors": true, "expected": {"properties": {"source": {"properties": {"ref": {"eq": {"linkTo": "$^^outside"}}}}, "copy": {"properties": {"ref": {}}}}}},
  {"name": "reference with merge properties", "input": "ref = $^sibling { x = 1 }", "expected": {"properties": {"ref": {"eq": {"linkTo": "$^sibling"}, "properties": {"x": {"eq": 1}}}}}},
  {"name": "eq merge adds to existing properties", "input": "a { x } a = hello { y }", "expected": {"properties": {"a": {"eq": "hello", "properties": {"x": {}, "y": {}}}}}},

  {"name": "heredoc basic", "input": "desc = <<<\n  Hello World\n  This is a test\n>>>", "expected": {"properties": {"desc": {"eq": "Hello World\nThis is a test\n"}}}},
  {"name": "heredoc indent stripping", "input": "code = <<<\n    if (true) {\n      doStuff()\n    }\n>>>", "expected": {"properties": {"code": {"eq": "if (true) {\n  doStuff()\n}\n"}}}},
  {"name": "heredoc empty", "input": "x = <<<\n>>>", "expected": {"properties": {"x": {"eq": ""}}}},
  {"name": "heredoc with empty lines", "input": "x = <<<\n  line one\n\n  line three\n>>>", "expected": {"properties": {"x": {"eq": "line one\n\nline three\n"}}}},
  {"name": "heredoc no indent", "input": "x = <<<\nhello\nworld\n>>>", "expected": {"properties": {"x": {"eq": "hello\nworld\n"}}}},

  {"name": "env reference", "input": "key = @env.API_KEY", "expected": {"properties": {"key": {"eq": {"env": "API_KEY"}}}}},
  {"name": "env reference in block", "input": "config { secret = @env.DB_PASSWORD }", "expected": {"properties": {"config": {"properties": {"secret": {"eq": {"env": "DB_PASSWORD"}}}}}}},
  {"name": "env reference in array", "input": "keys = [@env.KEY1, @env.KEY2]", "expected": {"properties": {"keys": {"eq": [{"eq": {"env": "KEY1"}}, {"eq": {"env": "KEY2"}}]}}}},
  {"name": "env reference with properties", "input": "db = @env.DB_URL { timeout = 30 }", "expected": {"properties": {"db": {"eq": {"env": "DB_URL"}, "properties": {"timeout": {"eq": 30}}}}}},
  {"name": "env reference assign both", "input": "a {x} a := @env.SECRET", "expected": {"properties": {"a": {"eq": {"env": "SECRET"}}}}},

  {"name": "bare name preserves existing node", "input": ["foo = hello { a b c }", "foo"], "expected": {"properties": {"foo": {"eq": "hello", "properties": {"a": {}, "b": {}, "c": {}}}}}},
  {"name": "bare name preserves value only", "input": ["x = 42", "x"], "expected": {"properties": {"x": {"eq": 42}}}},
  {"name": "bare name creates new if absent", "input": "newnode", "expected": {"properties": {"newnode": {}}}}
]
